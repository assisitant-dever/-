# 架构设计文档

架构设计文档是后端开发的"技术蓝图"，它定义系统整体技术架构，帮助开发团队统一对系统结构和技术实现方向的理解。一份完善的架构设计文档，能让后续开发少走弯路，确保系统从基础就具备稳定性和可扩展性。

## 系统架构核心组成

在实际项目中，架构设计需从入口层开始清晰规划。以常见的FastAPI应用为例，**main.py作为应用入口**，承担着配置路由和中间件的关键角色，这是架构落地的第一层实现。从整体视图看，架构设计需包含以下核心模块：

### 系统架构图

系统采用分层架构设计，主要包含以下组件：

1. **客户端层**：前端Web应用（http://localhost:3000）
2. **API网关层**：FastAPI应用入口（main.py），处理路由分发和跨域请求
3. **业务逻辑层**：按功能模块划分的API接口（api.py、conversations.py、auth.py等）
4. **数据访问层**：数据库交互模块（crud.py、database.py）
5. **数据存储层**：关系型数据库（MySQL）

**请求处理流程图**：
```
客户端请求 → CORS中间件处理 → 路由分发 → 对应模块处理 → 数据库交互 → 返回响应
```

关键监控节点：健康检查接口（/health）

### 技术栈选型

- **Web框架**：FastAPI（轻量高效，支持异步）
- **数据库**：MySQL（关系型数据库，使用SQLAlchemy ORM）
- **认证**：JWT（JSON Web Token）
- **跨域处理**：CORSMiddleware
- **API文档**：FastAPI自动生成的Swagger UI
- **文件存储**：本地文件系统（uploads/和generated_docs/目录）

技术选型遵循"适合团队"原则，例如团队熟悉FastAPI则无需强行引入复杂架构；关键技术方案（如中间件配置）需在开发前进行测试验证，避免上线后出现兼容性问题。

### 模块划分

按业务领域拆分核心模块并明确职责：

- **auth模块**：负责用户认证授权，处理登录、权限校验等逻辑（auth.py）
- **api模块**：提供核心业务接口，处理公文生成、模板管理等操作（api.py）
- **conversations模块**：管理用户对话数据，包括对话创建、历史记录查询等功能（conversations.py）
- **database模块**：数据库连接和会话管理（database.py）
- **models模块**：数据模型定义，包括数据库模型和Pydantic验证模型（models.py）
- **utils模块**：通用工具函数（utils.py）

### 模块间交互

通过路由注册实现模块通信，客户端请求经main.py路由分发至对应模块，处理结果沿原路径返回，形成"请求-处理-响应"的闭环数据流。

路由注册关系（main.py）：
- auth_router：用户注册/登录（/auth前缀）
- api_router：公文生成等通用接口（/api前缀）
- conv_router：对话功能接口（/api前缀）

### 关键技术方案

1. **跨域资源共享**：通过CORSMiddleware配置允许指定前端地址（http://localhost:3000）的跨域请求，支持credentials。

2. **健康检查机制**：提供/health接口，用于监控系统运行状态。

3. **数据库连接池**：配置合理的连接池参数（pool_size=10, max_overflow=20），优化数据库连接性能。

4. **异步支持**：FastAPI的异步特性支持高并发场景，同时提供异步数据库操作能力。

### 扩展性设计

- **横向扩展**：FastAPI的异步特性支持在高并发场景下的横向扩展
- **功能扩展**：模块化路由设计便于新增业务模块，例如后续添加payment模块时，只需注册新路由即可集成到系统中
- **存储扩展**：文件存储可根据需求迁移至云存储服务（如S3）

## 注意事项

- 架构图需避免复杂符号，用简洁箭头和模块框清晰展示组件关系
- 技术选型时拒绝"为技术而技术"，以解决实际问题为目标
- 整体设计以"够用即可"为原则，过度设计反而会增加维护成本
- 关键配置（如数据库连接参数）应使用环境变量，避免硬编码

通过以上内容的梳理，架构设计文档既能为开发提供明确指导，又能确保系统具备应对未来需求变化的弹性。